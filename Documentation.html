<!DOCTYPE html>
<html style="font-size: 16px;">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>Documentation</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="prism.css" media="screen">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/templatemo-style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

<link rel="stylesheet" href="Documentation.css" media="screen">
    <script type="text/javascript" src="prism.js"></script>
    <script class="u-script" type="text/javascript" src="jquery-1.9.1.min.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="js/plugins.js"></script>
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i">
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "crosscountryconnections",
		"logo": "images/CCC logo.png"
}</script>
    <script>
      function w3_open() {
        document.getElementById("sidebar").style.display = "block";
      }

      function w3_close() {
        document.getElementById("sidebar").style.display = "none";
      }
    </script>


    <meta property="og:title" content="Documentation">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#60d394">
  </head>
  <body class="u-body"><div class="u-clearfix u-grey-greeen u-header u-header u-sticky" id="myHeader"><div class="u-clearfix u-sheet u-sheet-1">
        <a href="/index.html" data-page-id="443509" class="u-image u-logo u-image-1" data-image-width="80" data-image-height="40">
          <img src="images/CCC logo.png" class="u-logo-image u-logo-image-1" data-image-width="64" width="40px">
        </a>
        <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
          <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px;">
            <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-active-color u-custom-text-color u-custom-text-hover-color u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
              <svg><use xlink:href="#menu-hamburger"></use></svg>
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="menu-hamburger" viewBox="0 0 16 16" style="width: 16px; height: 16px;"><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</symbol>
</defs></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container" id="myHeader1">
            <ul class="u-nav u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-white u-text-hover-palette-5-base u-text-palette-3-base" href="index.html" style="padding: 10px 20px;">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-white u-text-hover-palette-5-base u-text-palette-3-base" href="About.html" style="padding: 10px 20px;">About</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-white u-text-hover-palette-5-base u-text-palette-3-base" href="Blogs.html" style="padding: 10px 20px;">Blogs</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-white u-text-hover-palette-5-base u-text-palette-3-base" href="Documentation.html" style="padding: 10px 20px;">Technical Documentation</a>
</li></ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="index.html" style="padding: 10px 20px;">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="About.html" style="padding: 10px 20px;">About</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Blogs.html" style="padding: 10px 20px;">Blogs</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Documentation.html" style="padding: 10px 20px;">Technical Documentation</a>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
      </div></div> 


    <!-- sidebar -->
    <div class="w3-sidebar w3-bar-block w3-collapse w3-card w3-green w3-animate-left" style="width:250px" id="sidebar">
      <button class="w3-bar-item w3-button w3-hide-large w3-hover-blue-grey" onclick="w3_close()">Close &times;</button>
      <h3 class="w3-bar-item">Documentation</h3>
      <a href="#prototyping" class="w3-bar-item w3-button w3-hover-blue-grey">Prototyping</a>
      <a href="#finalbuild" class="w3-bar-item w3-button w3-hover-blue-grey">Final Physical Build</a>
      <a href="#codearduino" class="w3-bar-item w3-button w3-hover-blue-grey">Code for Arduino</a>
      <a href="#codemqtt" class="w3-bar-item w3-button w3-hover-blue-grey">Code for Unity and MQTT</a>
      <a href="#usertest" class="w3-bar-item w3-button w3-hover-blue-grey">User Testing</a>
      <a href="#gallery" class="w3-bar-item w3-button w3-hover-blue-grey">Gallery</a>
    </div>

    <!-- page content -->
    <div class="w3-main" style="margin-left:250px; background-color:#D9FAC6; ">
      <div class="w3-container">
        <button class="w3-button w3-green w3-xlarge w3-hide-large w3-hover-blue-grey" onclick="w3_open()">&#9776;</button>
        <div class="w3-container">
        <h1>Documentation</h1>

        <h2 id="prototyping">Prototyping</h2>
      <p>
        In the prototypes, we used: <br>
        <ul>
          <li>30 push buttons</li>
          <li>2 LED light strips</li>
          <li>2 Arduinos</li>
          <li>2 insulated wire</li>
          <li>cardboard</li>
        </ul>
        We used these to create two smaller versions to test how the spacing could work, as well as making sure we connect them across the country. 
      </p>
      
      <h2 id="finalbuild">Final Physical Build</h2>
      <p>
        For the final installations, we will be using: <br>
        <!-- will need to change this to past tense after finish building -->
        <ul>
          <li>12 LED light strips</li>
          <li>512 push buttons</li>
          <li>2 Raspberry Pi Computers</li>
          <li>2 Protoboards</li>
          <li>2 Arduinos</li>
          <li>2 frosted acrylic boards</li>
          <li>2 4x4 wood sheets</li>
          <li>bolts, spaces, and screws</li>
          <li>2 power supplies</li>
          <li>2 port expanders</li>
        </ul>
        We will continue to update this list as we make progress on the final build. 
      </p>
      <h2 id="codearduino">Code for Arduino</h2>
      <p>
        The following is the code we implemented to connect the two boards and synchronize the lights and buttons. 
      </p>
      <pre>
        <code class="language-c">
  
  // NeoPixel Ring simple sketch (c) 2013 Shae Erisson
  // Released under the GPLv3 license to match the rest of the
  // Adafruit NeoPixel library
  
  #include &lt;Adafruit_NeoPixel.h&gt;
  #ifdef __AVR__
  #include &lt;avr/power.h&gt; // Required for 16 MHz Adafruit Trinket
  #endif
  
  // Which pin on the Arduino is connected to the NeoPixels?
  #define LEDPIN 6 // On Trinket or Gemma, suggest changing this to 1
  
  // How many NeoPixels are attached to the Arduino?
  #define NUMPIXELS 90 // Popular NeoPixel ring size
  
  // When setting up the NeoPixel library, we tell it how many pixels,
  // and which pin to use to send signals. Note that for older NeoPixel
  // strips you might need to change the third parameter -- see the
  // strandtest example for more information on possible values.
  Adafruit_NeoPixel pixels(NUMPIXELS, LEDPIN, NEO_GRB + NEO_KHZ800);
  
  const int buttonSize = 15;  
  
  const int buttonPin[buttonSize] = {A0, A1, A2, 
                              A3, A4, A5, 
                              2, 3, 4, 
                              8, 9, 10, 
                              11, 12, 13};   
  
  bool buttonSwitch[buttonSize];
  bool buttonUnpressed[buttonSize];
  bool receivedValues[buttonSize];
  int buttonReceived = 0;
  bool newReceived = false;
  
  void setup() {
    // These lines are specifically to support the Adafruit Trinket 5V 16 MHz.
    // Any other board, you can remove this part (but no harm leaving it):
  #if defined(__AVR_ATtiny85__) && (F_CPU == 16000000)
    clock_prescale_set(clock_div_1);
  #endif
    // END of Trinket-specific code.
  
    pixels.begin(); // INITIALIZE NeoPixel strip object (REQUIRED)
  
    for(int i=0; i&lt;15; i++){
      pinMode(buttonPin[i], INPUT_PULLUP);
    }
  
    Serial.begin(115200);
    
    pixels.clear(); // Set all pixel colors to 'off'
  
  }
  
  void loop() {
    for(int i=0; i&lt;buttonSize; i++){
      if(digitalRead(buttonPin[i]) == LOW && buttonUnpressed[i]) { //pressed and previously unpressed
        buttonSwitch[i] = !buttonSwitch[i]; //if light on turn light off, if light off turn light on 
        buttonUnpressed[i] = false;
        Serial.println(i);
        int n = i*3+(i/3)*11; //connecting each button to its three lights  
  
        if(buttonSwitch[i]) {
          pixels.setPixelColor(n, pixels.Color(0, 0, 150));
          pixels.setPixelColor(n+1, pixels.Color(0, 0, 150));
          pixels.setPixelColor(n+2, pixels.Color(0, 0, 150));
        } else {
          pixels.setPixelColor(n, pixels.Color(0, 0, 0));
          pixels.setPixelColor(n+1, pixels.Color(0, 0, 0));
          pixels.setPixelColor(n+2, pixels.Color(0, 0, 0));
        }
      } 
  
      if(digitalRead(buttonPin[i]) == HIGH && !buttonUnpressed[i]){
        buttonUnpressed[i] = true;
      }
    }
  
    if(newReceived) {
      Serial.println(buttonReceived);
      receivedValues[buttonReceived] = !receivedValues[buttonReceived];
      newReceived = false;
      int i = buttonReceived;
      int j = i - (i%3) + ((i%3)*2+2)%3;
      int n = 10 + j*3 + (j/3)*11;
      //if doing 2 lights to each button: 
      //int j = i - (i%3) + ((i%3)*2+2)%3;
      //int n = 7 + j*2 + (j/3)*8;

      
      if(receivedValues[buttonReceived]) {
        pixels.setPixelColor(n, pixels.Color(150, 0, 0));
        pixels.setPixelColor(n+1, pixels.Color(150, 0, 0));
        pixels.setPixelColor(n+2, pixels.Color(150, 0, 0));
      } else {
        pixels.setPixelColor(n, pixels.Color(0, 0, 0));
        pixels.setPixelColor(n+1, pixels.Color(0, 0, 0));
        pixels.setPixelColor(n+2, pixels.Color(0, 0, 0));
      }
    }
    pixels.show();
  }
  
  void serialEvent() {
    while(Serial.available()){
      buttonReceived = Serial.readString().toInt();
      
      newReceived = true;
    }
  }


        </code>
      </pre>
      <h2 id="codemqtt">Code for Unity and MQTT</h2>
      <p>The following code is what we are using to connect MQTT to Unity to look at our button presses digitally. 
        <br> We used the HIVEMQ public MQTT broker to send and receive messages. To connect our Arduinos to MQTT, we used CMU IDeATe's MQTT-Arduino bridge. 
      </p>
      <pre>
        <code class="language-csharp">
          /*
The MIT License (MIT)

Copyright (c) 2018 Giovanni Paolo Vigano'

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/

using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using uPLibrary.Networking.M2Mqtt;
using uPLibrary.Networking.M2Mqtt.Messages;

/// <summary>
/// Adaptation for Unity of the M2MQTT library (https://github.com/eclipse/paho.mqtt.m2mqtt),
/// modified to run on UWP (also tested on Microsoft HoloLens).
/// </summary>
namespace M2MqttUnity
{
    /// <summary>
    /// Generic MonoBehavior wrapping a MQTT client, using a double buffer to postpone message processing in the main thread. 
    /// </summary>
    public class M2MqttUnityClient : MonoBehaviour
    {
        // public GameObject Canvas;
        public cloner cloner;
        public GameObject[] clones = new GameObject[256];
        public button_pressl buttpress;

        [Header("MQTT broker configuration")]
        [Tooltip("IP address or URL of the host running the broker")]
        public string brokerAddress = "localhost";
        [Tooltip("Port where the broker accepts connections")]
        public int brokerPort = 1883;
        [Tooltip("Use encrypted connection")]
        public bool isEncrypted = false;
        [Header("Connection parameters")]
        [Tooltip("Connection to the broker is delayed by the the given milliseconds")]
        public int connectionDelay = 500;
        [Tooltip("Connection timeout in milliseconds")]
        public int timeoutOnConnection = MqttSettings.MQTT_CONNECT_TIMEOUT;
        [Tooltip("Connect on startup")]
        public bool autoConnect = true;
        [Tooltip("UserName for the MQTT broker. Keep blank if no user name is required.")]
        public string mqttUserName = null;
        [Tooltip("Password for the MQTT broker. Keep blank if no password is required.")]
        public string mqttPassword = null;
        
        /// <summary>
        /// Wrapped MQTT client
        /// </summary>
        protected MqttClient client;

        private List<MqttMsgPublishEventArgs> messageQueue1 = new List<MqttMsgPublishEventArgs>();
        private List<MqttMsgPublishEventArgs> messageQueue2 = new List<MqttMsgPublishEventArgs>();
        private List<MqttMsgPublishEventArgs> frontMessageQueue = null;
        private List<MqttMsgPublishEventArgs> backMessageQueue = null;
        private bool mqttClientConnectionClosed = false;
        private bool mqttClientConnected = false;

        /// <summary>
        /// Event fired when a connection is successfully established
        /// </summary>
        public event Action ConnectionSucceeded;
        /// <summary>
        /// Event fired when failing to connect
        /// </summary>
        public event Action ConnectionFailed;

        /// <summary>
        /// Connect to the broker using current settings.
        /// </summary>
        public virtual void Connect()
        {
            if (client == null || !client.IsConnected)
            {
                StartCoroutine(DoConnect());
            }
        }

        /// <summary>
        /// Disconnect from the broker, if connected.
        /// </summary>
        public virtual void Disconnect()
        {
            if (client != null)
            {
                StartCoroutine(DoDisconnect());
            }
        }

        /// <summary>
        /// Override this method to take some actions before connection (e.g. display a message)
        /// </summary>
        protected virtual void OnConnecting()
        {
            Debug.LogFormat("Connecting to broker on {0}:{1}...\n", brokerAddress, brokerPort.ToString());
        }

        /// <summary>
        /// Override this method to take some actions if the connection succeeded.
        /// </summary>
        protected virtual void OnConnected()
        {
            Debug.LogFormat("Connected to {0}:{1}...\n", brokerAddress, brokerPort.ToString());

            SubscribeTopics();

            if (ConnectionSucceeded != null)
            {
                ConnectionSucceeded();
            }
        }

        /// <summary>
        /// Override this method to take some actions if the connection failed.
        /// </summary>
        protected virtual void OnConnectionFailed(string errorMessage)
        {
            Debug.LogWarning("Connection failed.");
            if (ConnectionFailed != null)
            {
                ConnectionFailed();
            }
        }

        /// <summary>
        /// Override this method to subscribe to MQTT topics.
        /// </summary>
        protected virtual void SubscribeTopics()
        {
            client.Subscribe(new string[] { "erica" }, new byte[] { MqttMsgBase.QOS_LEVEL_EXACTLY_ONCE });
            client.Subscribe(new string[] { "michelle" }, new byte[] {MqttMsgBase.QOS_LEVEL_EXACTLY_ONCE});
        }

        /// <summary>
        /// Override this method to unsubscribe to MQTT topics (they should be the same you subscribed to with SubscribeTopics() ).
        /// </summary>
        protected virtual void UnsubscribeTopics()
        {
            client.Unsubscribe(new string[] { "erica" });
            client.Unsubscribe(new string[] { "michelle" });
        }

        /// <summary>
        /// Disconnect before the application quits.
        /// </summary>
        protected virtual void OnApplicationQuit()
        {
            CloseConnection();
        }

        /// <summary>
        /// Initialize MQTT message queue
        /// Remember to call base.Awake() if you override this method.
        /// </summary>
        protected virtual void Awake()
        {
            frontMessageQueue = messageQueue1;
            backMessageQueue = messageQueue2;
        }

        /// <summary>
        /// Connect on startup if autoConnect is set to true.
        /// </summary>
        protected virtual void Start()
        {
            GameObject test = GameObject.Find("Canvas");
            cloner cloner = test.GetComponent<cloner>();
            clones = cloner.clones;
            if(clones == null) {Debug.Log("clones null");}
            // List<GameObject> clones = cloner.cloneList;


            // GameObject combo = GameObject.Find("Canvas/combo");
            GameObject combo = test.transform.Find("combo").gameObject;
            if(combo == null) { Debug.Log("combo null");}
            buttpress = combo.GetComponent<button_pressl>();
            if(buttpress == null) { Debug.Log("pretzel null");}


            if (autoConnect)
            {
                Connect();
            }
        }

        /// <summary>
        /// Override this method for each received message you need to process.
        /// </summary>
        protected virtual void DecodeMessage(string topic, byte[] message)
        {
            string msg = System.Text.Encoding.UTF8.GetString(message);
            int lightnum = int.Parse(msg);
            Debug.LogFormat("Message received on topic: {0} - {1}", topic, lightnum);

            if(lightnum == -1) {
                for(int i = 0; i < 256; i++){
                    buttpress.combo = clones[i];
                    buttpress.reset(buttpress.combo);
                }
                Debug.Log("board reset");
            }
            else if(topic == "erica"){
                if (buttpress == null) {
                    Debug.Log("no butt");
                } else if (clones[lightnum] == null) {
                    Debug.Log("no clones");
                } else {
                    if(lightnum>0){buttpress.combo = clones[lightnum-1];}
                    buttpress.TaskOnClickLeft(buttpress.combo);
                }
            }
            else if(topic == "michelle"){
                if (buttpress == null) {
                    Debug.Log("no butt");
                } else if (clones[lightnum] == null) {
                    Debug.Log("no clones");
                } else {
                    if(lightnum>0){buttpress.combo = clones[lightnum-1];}
                    buttpress.TaskOnClickRight(buttpress.combo);
                }
            }
        }

        /// <summary>
        /// Override this method to take some actions when disconnected.
        /// </summary>
        protected virtual void OnDisconnected()
        {
            Debug.Log("Disconnected.");
        }

        /// <summary>
        /// Override this method to take some actions when the connection is closed.
        /// </summary>
        protected virtual void OnConnectionLost()
        {
            Debug.LogWarning("CONNECTION LOST!");
        }

        /// <summary>
        /// Processing of income messages and events is postponed here in the main thread.
        /// Remember to call ProcessMqttEvents() in Update() method if you override it.
        /// </summary>
        protected virtual void Update()
        {
            ProcessMqttEvents();
        }

        protected virtual void ProcessMqttEvents()
        {
            // process messages in the main queue
            SwapMqttMessageQueues();
            ProcessMqttMessageBackgroundQueue();
            // process messages income in the meanwhile
            SwapMqttMessageQueues();
            ProcessMqttMessageBackgroundQueue();

            if (mqttClientConnectionClosed)
            {
                mqttClientConnectionClosed = false;
                OnConnectionLost();
            }
        }

        private void ProcessMqttMessageBackgroundQueue()
        {
            foreach (MqttMsgPublishEventArgs msg in backMessageQueue)
            {
                DecodeMessage(msg.Topic, msg.Message);
            }
            backMessageQueue.Clear();
        }

        /// <summary>
        /// Swap the message queues to continue receiving message when processing a queue.
        /// </summary>
        private void SwapMqttMessageQueues()
        {
            frontMessageQueue = frontMessageQueue == messageQueue1 ? messageQueue2 : messageQueue1;
            backMessageQueue = backMessageQueue == messageQueue1 ? messageQueue2 : messageQueue1;
        }

        private void OnMqttMessageReceived(object sender, MqttMsgPublishEventArgs msg)
        {
            frontMessageQueue.Add(msg);
        }

        private void OnMqttConnectionClosed(object sender, EventArgs e)
        {
            // Set unexpected connection closed only if connected (avoid event handling in case of controlled disconnection)
            mqttClientConnectionClosed = mqttClientConnected;
            mqttClientConnected = false;
        }

        /// <summary>
        /// Connects to the broker using the current settings.
        /// </summary>
        /// <returns>The execution is done in a coroutine.</returns>
        private IEnumerator DoConnect()
        {
            // wait for the given delay
            yield return new WaitForSecondsRealtime(connectionDelay / 1000f);
            // leave some time to Unity to refresh the UI
            yield return new WaitForEndOfFrame();

            // create client instance 
            if (client == null)
            {
                try
                {
#if (!UNITY_EDITOR && UNITY_WSA_10_0 && !ENABLE_IL2CPP)
                    client = new MqttClient(brokerAddress,brokerPort,isEncrypted, isEncrypted ? MqttSslProtocols.SSLv3 : MqttSslProtocols.None);
#else
                    client = new MqttClient(brokerAddress, brokerPort, isEncrypted, null, null, isEncrypted ? MqttSslProtocols.SSLv3 : MqttSslProtocols.None);
                    //System.Security.Cryptography.X509Certificates.X509Certificate cert = new System.Security.Cryptography.X509Certificates.X509Certificate();
                    //client = new MqttClient(brokerAddress, brokerPort, isEncrypted, cert, null, MqttSslProtocols.TLSv1_0, MyRemoteCertificateValidationCallback);
#endif
                }
                catch (Exception e)
                {
                    client = null;
                    Debug.LogErrorFormat("CONNECTION FAILED! {0}", e.ToString());
                    OnConnectionFailed(e.Message);
                    yield break;
                }
            }
            else if (client.IsConnected)
            {
                yield break;
            }
            OnConnecting();

            // leave some time to Unity to refresh the UI
            yield return new WaitForEndOfFrame();
            yield return new WaitForEndOfFrame();

            client.Settings.TimeoutOnConnection = timeoutOnConnection;
            string clientId = Guid.NewGuid().ToString();
            try
            {
                client.Connect(clientId, mqttUserName, mqttPassword);
            }
            catch (Exception e)
            {
                client = null;
                Debug.LogErrorFormat("Failed to connect to {0}:{1}:\n{2}", brokerAddress, brokerPort, e.ToString());
                OnConnectionFailed(e.Message);
                yield break;
            }
            if (client.IsConnected)
            {
                client.ConnectionClosed += OnMqttConnectionClosed;
                // register to message received 
                client.MqttMsgPublishReceived += OnMqttMessageReceived;
                mqttClientConnected = true;
                OnConnected();
            }
            else
            {
                OnConnectionFailed("CONNECTION FAILED!");
            }
        }

        private IEnumerator DoDisconnect()
        {
            yield return new WaitForEndOfFrame();
            CloseConnection();
            OnDisconnected();
        }

        private void CloseConnection()
        {
            mqttClientConnected = false;
            if (client != null)
            {
                if (client.IsConnected)
                {
                    UnsubscribeTopics();
                    client.Disconnect();
                }
                client.MqttMsgPublishReceived -= OnMqttMessageReceived;
                client.ConnectionClosed -= OnMqttConnectionClosed;
                client = null;
            }
        }

#if ((!UNITY_EDITOR && UNITY_WSA_10_0))
        private void OnApplicationFocus(bool focus)
        {
            // On UWP 10 (HoloLens) we cannot tell whether the application actually got closed or just minimized.
            // (https://forum.unity.com/threads/onapplicationquit-and-ondestroy-are-not-called-on-uwp-10.462597/)
            if (focus)
            {
                Connect();
            }
            else
            {
                CloseConnection();
            }
        }
#endif
    }
}

        </code>
      </pre>
      
      <h2 id="usertest">User Testing</h2>
      <p>
        Based on user testing from the prototypes, we learned: 
        <ul>
          <li>users could easily get bored</li>
          <li>we would need a key to explain the left and right sides of the buttons</li>
          <li>boards did not match when there were a lot of inputs (i.e. button presses at the same time) </li>
          <li>we could set goals for users:</li>
          <ul>
            <li>make suggestions for users to draw</li>
            <li>encourage a game of tic tac toe (we could have a preset that transforms board into a tic tac toe board)</li>
          </ul>
          <li>lights were a little bright (we will be using acrylic to diffuse the light and are considering having a knob to control brightness)</li>
          <li>we could consider adding a reset button to clear the board</li>
        </ul>
      </p> 
      
      <h2 id="gallery">Gallery</h2>

      <div class="row tm-mb-90 tm-gallery">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
          <figure class="effect-ming tm-video-item">
            <img src="images/IMG_6356.png" alt="wood backing" class="img-fluid">
            <figcaption class="d-flex align-items-center justify-content-center">
              <h3>Wood Backing</h3>
              <a href="images/IMG_6356.png">View more</a>
            </figcaption>
          </figure>
      </div>
      </div>
      <div class="row tm-mb-90 tm-gallery">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
          <figure class="effect-ming tm-video-item">
            <img src="images/IMG_6388.png" alt="Putting all buttons in" class="img-fluid">
            <figcaption class="d-flex align-items-center justify-content-center">
              <h3>Putting all buttons in</h3>
              <a href="images/IMG_6388.png">View more</a>
            </figcaption>
          </figure>
      </div></div>
      <div class="row tm-mb-90 tm-gallery">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
          <figure class="effect-ming tm-video-item">
            <img src="images/IMG_6441.png" alt="Wiring on board" class="img-fluid">
            <figcaption class="d-flex align-items-center justify-content-center">
              <h3>Wiring on board</h3>
              <a href="images/IMG_6441.png">View more</a>
            </figcaption>
          </figure>
      </div></div>
      <div class="row tm-mb-90 tm-gallery">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
          <figure class="effect-ming tm-video-item">
            <img src="images/IMG_6499.png" alt="Wiring the buttons" class="img-fluid">
            <figcaption class="d-flex align-items-center justify-content-center">
              <h3>Wiring the buttons</h3>
              <a href="images/IMG_6499.png">View more</a>
            </figcaption>
          </figure>
      </div></div>
      <div class="row tm-mb-90 tm-gallery">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
          <figure class="effect-ming tm-video-item">
            <img src="images/IMG_6402.png" alt="Description panels" class="img-fluid">
            <figcaption class="d-flex align-items-center justify-content-center">
              <h3>Description panels</h3>
              <a href="images/IMG_6402.png">View more</a>
            </figcaption>
          </figure>
      </div></div>
      <div class="row tm-mb-90 tm-gallery">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
          <figure class="effect-ming tm-video-item">
            <img src="images/ericaprocess1.jpeg" alt="wood backing" class="img-fluid">
            <figcaption class="d-flex align-items-center justify-content-center">
              <h3>Programming Lights</h3>
              <a href="images/ericaprocess1.jpeg">View more</a>
            </figcaption>
          </figure>
      </div></div>
      <div class="row tm-mb-90 tm-gallery">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
          <figure class="effect-ming tm-video-item">
            <img src="images/ericaprocess2.jpeg" alt="Wiring" class="img-fluid">
            <figcaption class="d-flex align-items-center justify-content-center">
              <h3>Wiring</h3>
              <a href="images/ericaprocess2.jpeg">View more</a>
            </figcaption>
          </figure>
      </div></div>
      <div class="row tm-mb-90 tm-gallery">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
          <figure class="effect-ming tm-video-item">
            <img src="images/ericaprocess3.jpeg" alt="more wiring" class="img-fluid">
            <figcaption class="d-flex align-items-center justify-content-center">
              <h3>More Wiring</h3>
              <a href="images/ericaprocess3.jpeg">View more</a>
            </figcaption>
          </figure>
      </div></div>
      <div class="row tm-mb-90 tm-gallery">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
          <figure class="effect-ming tm-video-item">
            <img src="images/ericaprocess4.jpeg" alt="wiring Organization" class="img-fluid">
            <figcaption class="d-flex align-items-center justify-content-center">
              <h3>Wire Organization</h3>
              <a href="images/ericaprocess4.jpeg">View more</a>
            </figcaption>
          </figure>
      </div></div>


      <video controls loop autoplay muted width="600" style="padding-top: 50px;">
        <source src="images/IMG_6375.mp4" type="video/mp4">
      </video>
      <div class="caption" style="text-align: left;padding-top: 0;">Laser cutting the description panels</div>
      <br><br>
      
    </div>
    </div>
  </div>

    </body>
    </html>